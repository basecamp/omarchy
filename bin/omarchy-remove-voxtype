#!/bin/bash
set -e

# Remove voxtype and its configurations.

# Remove services
systemctl --user stop voxtype.service 2>/dev/null || true
rm -f ~/.config/systemd/user/voxtype*
systemctl --user daemon-reload

# Remove packages and configs
omarchy-pkg-drop wtype voxtype-bin
rm -rf ~/.config/voxtype
rm -rf ~/.local/share/voxtype

# Remove from waybar
waybar_config=~/.config/waybar/config.jsonc
waybar_style=~/.config/waybar/style.css

# Remove voxtype CSS from waybar style
if grep -q "custom-voxtype" "$waybar_style"; then
  sed -i '/#custom-voxtype {/,/^}/d' "$waybar_style"
fi

# Remove voxtype module from waybar config
if grep -q '"custom/voxtype"' "$waybar_config"; then
  # Remove the module entry from the array
  sed -i '/"custom\/voxtype",/d' "$waybar_config"
  # Remove the custom/voxtype block definition
  sed -i '/"custom\/voxtype"[[:space:]]*:[[:space:]]*{/,/^[[:space:]]*},/d' "$waybar_config"
fi

omarchy-restart-waybar
