# Detects if the system is running on legacy hardware that requires a legacy driver.
#
# Ghostty requires modern GPU acceleration (OpenGL/Vulkan) which is often unstable or
# missing on legacy hardware (specifically those using drivers in the 'legacy_drivers' list).
# In these cases, we need to detect this state to fallback to a lighter terminal
# (like Alacritty) to ensure the system is usable out of the box.
#
# Returns 0 if legacy hardware is detected, 1 otherwise.

# List of legacy drivers that require fallback
legacy_drivers=("radeon")

# Check /sys/class/drm for a card using a legacy driver
for card in /sys/class/drm/card*; do
    if [[ -e "$card/device/driver" ]]; then
        driver=$(basename "$(readlink -f "$card/device/driver")")
        
        for legacy in "${legacy_drivers[@]}"; do
            if [[ "$driver" == "$legacy" ]]; then
                exit 0
            fi
        done
    fi
done

exit 1
