#!/bin/bash

# set background image by index for current theme

BACKGROUNDS_DIR="$HOME/.config/omarchy/current/theme/backgrounds/"
CURRENT_BACKGROUND_LINK="$HOME/.config/omarchy/current/background"

mapfile -d '' -t BACKGROUNDS < <(find "$BACKGROUNDS_DIR" -type f -print0 | sort -z)
TOTAL=${#BACKGROUNDS[@]}
MAX_INDEX=$((TOTAL - 1))

NEW_INDEX=$1

if [[ NEW_INDEX -le -1 || NEW_INDEX -gt MAX_INDEX ]]; then
  notify-send "Background index out of range - setting it to 0"
  NEW_INDEX=0
fi


if [[ $TOTAL -eq 0 ]]; then
  notify-send "No background was found for theme" -t 2000
  pkill -x swaybg
  setsid uwsm app -- swaybg --color '#000000' >/dev/null 2>&1 &
else
  NEW_BACKGROUND="${BACKGROUNDS[$NEW_INDEX]}"

  # Set new background symlink
  ln -nsf "$NEW_BACKGROUND" "$CURRENT_BACKGROUND_LINK"

  # Relaunch swaybg
  pkill -x swaybg
  setsid uwsm app -- swaybg -i "$CURRENT_BACKGROUND_LINK" -m fill >/dev/null 2>&1 &
fi
