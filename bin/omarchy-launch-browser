#!/bin/bash

browser_exec=$(sed -n 's/^Exec=\([^ ]*\).*/\1/p' {~/.local,~/.nix-profile,/usr}/share/applications/$(xdg-settings get default-web-browser) 2>/dev/null | head -1)

case "$browser_exec" in
*firefox*)
  private_flag="--private-window"
  ;;
*)
  private_flag="--incognito"
  ;;
esac

args=("$@")
for i in "${!args[@]}"; do
  [[ "${args[i]}" == "--private" ]] && args[i]="$private_flag"
done

exec setsid uwsm app -- "$browser_exec" "${args[@]}"
