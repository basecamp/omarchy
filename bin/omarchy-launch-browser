
# Launch the default browser as determined by xdg-settings.
# Automatically converts --private into the correct flag for the given browser.

default_browser=$(@xdg-settings@ get default-web-browser)
browser_exec="@webappBrowser@"
search_dirs="${XDG_DATA_HOME:-$HOME/.local/share}:${XDG_DATA_DIRS:-/usr/local/share:/usr/share}"
IFS=':' read -ra paths <<< "$search_dirs"

for dir in "${paths[@]}"; do
  if [[ -f "$dir/applications/$default_browser" ]]; then
    browser_exec=$(sed -n 's/^Exec=\([^ ]*\).*/\1/p' "$dir/applications/$default_browser" | head -n 1)
    break
  fi
done

if [[ $browser_exec =~ (firefox|zen|librewolf|mullvad) ]]; then
  private_flag="--private-window"
elif [[ $browser_exec =~ edge ]]; then
  private_flag="--inprivate"
else
  private_flag="--incognito"
fi

exec setsid @uwsm-app@ -- "$browser_exec" "${@/--private/$private_flag}"
