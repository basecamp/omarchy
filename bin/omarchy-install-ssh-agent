#!/bin/bash

# add ssh keys to ssh-agent
mkdir -p ~/.ssh
echo 'AddKeysToAgent yes' | tee -a ~/.ssh/config >/dev/null

# Create systemd service for ssh-agent
mkdir -p ~/.config/systemd/user
tee ~/.config/systemd/user/ssh-agent.service >/dev/null <<EOF
[Unit]
Description=SSH key agent

[Service]
Type=simple
Environment=SSH_AUTH_SOCK=%t/ssh-agent.socket
# DISPLAY required for ssh-askpass to work
Environment=DISPLAY=:0
ExecStart=/usr/bin/ssh-agent -D -a $SSH_AUTH_SOCK

[Install]
WantedBy=default.target
EOF

# Ensure Hyprland picks up the SSH_AUTH_SOCK variable
echo 'env = SSH_AUTH_SOCK,$XDG_RUNTIME_DIR/ssh-agent.socket' | tee -a ~/.config/hypr/envs.conf >/dev/null

# Start ssh-agent automatically for user
systemctl enable --user ssh-agent.service

echo 'SSH Agent has been installed and enabled. Please reboot to apply changes.'