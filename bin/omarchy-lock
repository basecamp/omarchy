#!/bin/bash

set -euo pipefail

usage() {
	cat <<'EOF'
Usage: omarchy-lock <value>

Creates a lock file at:
	$HOME/.local/state/omarchy/locks/<value>.config-lock

This will stop omarchy-update to replace your configuration.

Options:
	-h, --help   Show this help and exit

Notes:
	- <value> must consist of letters, numbers, dots, underscores, or dashes.
EOF
}

if [[ ${1:-} == "-h" || ${1:-} == "--help" ]]; then
	usage
	exit 0
fi

if [[ $# -ne 1 ]]; then
	echo "Error: exactly one <value> is required." >&2
	echo >&2
	usage >&2
	exit 2
fi

value="$1"

# Basic validation to prevent path traversal or odd characters
if [[ ! "$value" =~ ^[A-Za-z0-9._-]+$ ]]; then
	echo "Error: invalid value '$value'. Allowed: [A-Za-z0-9._-]" >&2
	exit 2
fi

lock_dir="$HOME/.local/state/omarchy/locks"
mkdir -p "$lock_dir"

lock_file="$lock_dir/${value}.config-lock"

# Create or truncate the lock file
: > "$lock_file"

echo "$lock_file"

