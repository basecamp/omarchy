#!/usr/bin/env bash
# Safe workspace swap between two monitors in Hyprland/Omarchy

readonly TMP_WORKSPACE=999
readonly APP_NAME="Omarchy"

mapfile -t MONITORS < <(hyprctl monitors -j | jq -r '.[].name')

if (( ${#MONITORS[@]} < 2 )); then
    notify-send "$APP_NAME" "Only one monitor detected â€” nothing to swap."
    exit 0
fi

readonly MON1="${MONITORS[0]}"
readonly MON2="${MONITORS[1]}"

get_active_workspace() {
    hyprctl monitors -j | jq -r ".[] | select(.name==\"$1\") | .activeWorkspace.id"
}

WS1=$(get_active_workspace "$MON1")
WS2=$(get_active_workspace "$MON2")

if [[ -z "$WS1" || -z "$WS2" ]]; then
    notify-send "$APP_NAME" "Could not detect active workspaces on both monitors."
    exit 1
fi

hyprctl dispatch workspace "$TMP_WORKSPACE"
hyprctl dispatch moveworkspacetomonitor "$TMP_WORKSPACE" "$MON1"
hyprctl dispatch moveworkspacetomonitor "$WS1" "$MON2"
hyprctl dispatch moveworkspacetomonitor "$WS2" "$MON1"
hyprctl dispatch workspace "$WS2"

notify-send "$APP_NAME" "Swapped workspaces between $MON1 and $MON2."
